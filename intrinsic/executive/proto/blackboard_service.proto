// Copyright 2023 Intrinsic Innovation LLC

syntax = "proto3";

package intrinsic_proto.executive;

import "google/protobuf/any.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

option go_package = "intrinsic/executive/proto/blackboard_service_go_proto";

message BlackboardValue {
  string key = 1;
  string scope = 2;
  string operation_name = 4;
  google.protobuf.Any value = 3;
}

service ExecutiveBlackboard {

  // Retrieves a specified blackboard value.
  rpc GetBlackboardValue(GetBlackboardValueRequest) returns (BlackboardValue) {}

  // List all available entries on the blackboard.
  rpc ListBlackboardValues(ListBlackboardValuesRequest)
      returns (ListBlackboardValuesResponse) {}

  // Update a specific value on the blackboard.
  // Updating a blackboard value that is a loop or retry node counter will also
  // change the node's internal counter.
  rpc UpdateBlackboardValue(UpdateBlackboardValueRequest)
      returns (BlackboardValue) {}

  // Delete a specific value on the blackboard.
  rpc DeleteBlackboardValue(DeleteBlackboardValueRequest)
      returns (google.protobuf.Empty) {}

}

message GetBlackboardValueRequest {
  string key = 1;

  // A blackboard key is scoped based on where it is defined.
  // If left unset this defaults to the scope of the current process tree.
  // When retrieving values within reusable processes the scope can be found in
  // the `blackboard_scope` field of a behavior tree in the RunMetadata.
  optional string scope = 2;

  string operation_name = 3;
}

message ListBlackboardValuesRequest {
  // Limit the request to a specific scope. Will return all blackboard values,
  // if not set.
  optional string scope = 1;
  string operation_name = 2;

  enum View {
    DEFAULT = 0;  // Currently this corresponds to ANY_TYPEURL_ONLY
    FULL = 1;
    ANY_TYPEURL_ONLY = 2;
  }
  View view = 3;
}

message ListBlackboardValuesResponse {
  repeated BlackboardValue values = 2;

  reserved "value_infos";
  reserved 1;
}

message UpdateBlackboardValueRequest {
  BlackboardValue value = 1;
}

message DeleteBlackboardValueRequest {
  string key = 1;
  // A blackboard key is scoped based on where it is defined.
  // If left unset this defaults to the scope of the current process tree.
  // When retrieving values within reusable processes the scope can be found in
  // the `blackboard_scope` field of a behavior tree in the RunMetadata.
  string scope = 2;
  string operation_name = 3;
}
