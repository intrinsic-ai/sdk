# Copyright 2023 Intrinsic Innovation LLC

"""Defines filegroups for the sysroot, providing essential system libraries and headers."""

filegroup(
    name = "all_files",
    srcs = glob(
        [
            "lib/x86_64-linux-gnu/ld*",
            "lib/x86_64-linux-gnu/libc*",
            "lib/x86_64-linux-gnu/libdl*",
            "lib/x86_64-linux-gnu/libgcc*",
            "lib/x86_64-linux-gnu/libm*",
            "lib/x86_64-linux-gnu/libpthread*",
            "lib/x86_64-linux-gnu/libresolv*",
            "lib/x86_64-linux-gnu/librt*",
            "lib/x86_64-linux-gnu/libutil*",
            "lib64/**",
            "usr/include/*.h",
            "usr/include/arpa/**",
            "usr/include/asm-generic/**",
            "usr/include/linux/**",
            "usr/include/net/**",
            "usr/include/netinet/**",
            "usr/include/rpc/**",
            "usr/include/scsi/**",
            "usr/include/sys/**",
            "usr/include/x86_64-linux-gnu/**",
            "usr/lib/gcc/**",
            "usr/lib/x86_64-linux-gnu/*crt*.o",
            "usr/lib/x86_64-linux-gnu/libc_nonshared.a",
            "usr/lib/x86_64-linux-gnu/libc.a",
            "usr/lib/x86_64-linux-gnu/libc.so",
            "usr/lib/x86_64-linux-gnu/libcrypt.a",
            "usr/lib/x86_64-linux-gnu/libcrypt.so",
            "usr/lib/x86_64-linux-gnu/libdl*",
            "usr/lib/x86_64-linux-gnu/libm*",
            "usr/lib/x86_64-linux-gnu/libpthread*",
            "usr/lib/x86_64-linux-gnu/libresolv.a",
            "usr/lib/x86_64-linux-gnu/libresolv.so",
            "usr/lib/x86_64-linux-gnu/librt*",
            "usr/lib/x86_64-linux-gnu/libutil*",
        ],
        exclude = [
            # The sysroot contains libstdc++, but we use libc++ from our toolchain
            # repo. Exclude these files so we don't pull them into the sandbox
            # unnecessarily. When upgrading, make sure the newest libstdc++ is
            # excluded.
            "usr/include/c++/**",
            "usr/include/x86_64-linux-gnu/c++/**",
            "usr/lib/gcc/x86_64-linux-gnu/6/libstdc++*",
            "usr/lib/gcc/x86_64-linux-gnu/10/libstdc++*",
            # The same applies to libffi.
            "usr/include/x86_64-linux-gnu/ffi*",
        ],
    ),
    visibility = ["//visibility:public"],
)

# using cc_library with `linkopts = ["-lX11"]` while including in all_files did not work. Therefore
# we explicitly create a filegroup of X11 libs and dependencies for usage in BUILD.nvidia_driver.
filegroup(
    name = "sysroot_x_runtime_libs_files",
    srcs = [
        "usr/lib/x86_64-linux-gnu/libX11.so.6",
        "usr/lib/x86_64-linux-gnu/libxcb.so.1",
        "usr/lib/x86_64-linux-gnu/libXau.so.6",
        "usr/lib/x86_64-linux-gnu/libXdmcp.so.6",
        "usr/lib/x86_64-linux-gnu/libXext.so.6",
        "usr/lib/x86_64-linux-gnu/libbsd.so.0",
    ],
    visibility = ["//visibility:public"],
)
