// Copyright 2023 Intrinsic Innovation LLC

syntax = "proto3";

package intrinsic_proto.geometry;

import "google/api/annotations.proto";
import "intrinsic/geometry/proto/geometry_service_types.proto";
import "intrinsic/geometry/proto/geometry_storage_refs.proto";
import "intrinsic/geometry/proto/v1/geometry.proto";
import "intrinsic/geometry/proto/v1/geometry_storage_refs.proto";

option go_package = "intrinsic/geometry/proto/geometry_service_go_proto";

// Geometry service is a mechanism for storing and retrieving geometry like
// meshes or primitives used within a world instance.
service GeometryService {
  // Gets the requested Geometry data. Includes computational geometry data as
  // well as the optional Renderable data if available. The Renderable data will
  // be at original quality.
  rpc GetGeometry(GetGeometryRequest) returns (GeometryWithMetadata) {
    option (google.api.http) = {
      // The required ref becomes the path parameter.
      // The optional renderable_ref will automatically map to a query parameter
      get: "/geometry/v0/geometries/{geometry_storage_refs.exact_geometry_ref}"
    };
  }

  // Gets the requested Renderable data at the requested LOD(Level of Detail).
  rpc GetRenderable(GetRenderableRequest) returns (RenderableWithMetadata) {
    option (google.api.http) = {
      get: "/geometry/v0/renderables/{geometry_storage_refs.exact_geometry_ref}"
    };
  }

  // Adds new geometry data to the service that can be fetched later.
  rpc CreateGeometry(CreateGeometryRequest) returns (GeometryWithMetadata) {
    option (google.api.http) = {
      post: "/geometry/v0/geometries"
      body: "*"
    };
  }

}

// Request message for getting geometry from the geometry service.
message GetGeometryRequest {
  // The references to the stored geometry being requested.
  // Deprecated, will be removed soon. Use geometry_storage_refs instead.
  GeometryStorageRefs geometry_storage_refs_v0 = 2 [deprecated = true];

  // The references to the stored geometry being requested.
  intrinsic_proto.geometry.v1.GeometryStorageRefs geometry_storage_refs = 3;

  reserved 1;
  reserved "geometry_id";
}

// Request message for getting renderable data from the geometry service.
message GetRenderableRequest {
  // The references to the stored geometry being requested.
  // Deprecated, will be removed soon. Use geometry_storage_refs instead.
  GeometryStorageRefs geometry_storage_refs_v0 = 3 [deprecated = true];

  // The references to the stored geometry being requested.
  intrinsic_proto.geometry.v1.GeometryStorageRefs geometry_storage_refs = 4;

  // The LOD to use when fetching the renderable data. 0 means the original
  // quality and any number above that will simplify the geometry. The higher
  // the number the more simplified it will be.
  uint32 lod_level = 2;

  reserved 1;
  reserved "geometry_id";
}

// Request message for adding new geometry to the geometry service
message CreateGeometryRequest {
  // The geometry data to store.
  GeometryData data = 1;
}
