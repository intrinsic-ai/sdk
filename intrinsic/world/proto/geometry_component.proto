// Copyright 2023 Intrinsic Innovation LLC

syntax = "proto3";

package intrinsic_proto.world;

import "intrinsic/geometry/proto/geometry_storage_refs.proto";
import "intrinsic/geometry/proto/v1/transformed_geometry.proto";
import "intrinsic/math/proto/matrix.proto";

// Runtime options for a Geometry.
message GeometryOptions {
  // If set, the octree will be filled on the inside when constructing the
  // octree for distance queries.
  optional bool fill_inside_for_distance_queries = 1;

}

// Component indicating the owning Entity has geometry (e.g. collision, visual,
// etc.).
message GeometryComponent {
  message Geometry {
    // Geometry storage refs is intended to be an (mostly) opaque container of
    // references to storage objects e.g. CAS URIs. The constituent fields
    // provide no guarantees of uniqueness.
    intrinsic_proto.geometry.GeometryStorageRefs geometry_storage_refs = 6;

    // A 4x4 affine transform matrix from reference frame to shape
    intrinsic_proto.Matrixd ref_t_shape_aff = 4;
    // Runtime options for this geometry.
    GeometryOptions options = 7;

    reserved 1, 2, 3;
    reserved "geometry_id", "ref_t_shape", "applied_scale";
  }

  // Used for the value type in proto map below.
  message GeometrySet {
    // Deprecated. We are in the process of migrating from this field to the
    // named_geometries field below. On deserialization, if both geometries and
    // named_geometries are populated, the named_geometries field will be used.
    // On serialization, both fields will be populated such that readers of this
    // field can still access the geometric data.
    // Note: Do not modify this field from a GeometryComponent received from the
    // ObjectWorldService and reuse it in another request. If you need to modify
    // in place, consider modifying named_geometries instead.
    repeated Geometry geometries = 1 [deprecated = true];

    // Map of human readable names to geometries.
    map<string, intrinsic_proto.geometry.v1.TransformedGeometry>
        named_geometries = 2;
  }

  // Stores named geometry for this entity. Names starting with "Intrinsic_" may
  // have special semantics. For example, geometries named "Intrinsic_Collision"
  // and "Intrinsic_Visual" indicate the geometry used for collision detection
  // and rendering, respectively. All other names are user-defined.
  //
  // It is expected that a component may contain the same geometry under
  // different names. For example, if an entity is using the same geometry for
  // both visualization and collision, it will be repeated under the
  // aforementioned names. User-defined names may further repeat or distinguish
  // geometries in user-defined ways.
  map<string, GeometrySet> named_geometries = 2;

  reserved 1;
  reserved "model";
}
